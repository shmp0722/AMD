function AMD_DiffusionMeasures_OR_removed



%%
AFQdata = '/media/HDPC-UT/dMRI_data';

subs = {...
    'AMD-01-dMRI-Anatomy-dMRI'
    'AMD-02-YM-dMRI-Anatomy'
    'AMD-03-CK-68yo-dMRI-Anatomy'
    'AMD-04-KM-72yo-dMRI-Anatomy'
    'AMD-05-YH-84yo-dMRI-Anatomy'
    'AMD-06-KS-79yo-dMRI-Anatomy'
    'AMD-07-KT-dMRI-Anatomy'
    'AMD-08-YA-20150426'
    'AMD-Ctl01-HM-dMRI-Anatomy-2014-09-09'
    'AMD-Ctl02-YM-dMRI-Anatomy-2014-09-09'
    'AMD-Ctl03-TS-dMRI-Anatomy-2014-10-28'
    'AMD-Ctl04-AO-61yo-dMRI-Anatomy'
    'AMD-Ctl05-TM-71yo-dMRI-Anatomy'
    'AMD-Ctl06-YM-66yo-dMRI-Anatomy'
    'AMD-Ctl07-MS-61yo-dMRI-Anatomy'
    'AMD-Ctl08-HO-62yo-dMRI-Anatomy'
    'AMD-Ctl09-KH-70yo-dMRI-Anatomy-dMRI'
    'AMD-Ctl10-TH-65yo-dMRI-Anatomy-dMRI'
    'AMD-Ctl11-YMS-64yo-dMRI-Anatomy'
    'AMD-Ctl12-YT-f59yo-20150222'};   

%%

for ii = 1:length(subs)
    SubDir = fullfile(AFQdata,subs{ii});
    OTdir  = fullfile(SubDir,'/dwi_1st/fibers/conTrack/OT_5K');
    ORdir  = fullfile(SubDir,'/dwi_1st/fibers/conTrack/OR_divided');
     
    % dirROI = fullfile(SubDir,'/dwi_2nd/ROIs');
    dt6 =dtiLoadDt6( fullfile(SubDir,'/dwi_1st/dt6.mat'));
    
    or=dir(fullfile(ORdir,'*4.pdb'));
    
    if length(or) ==6    
    % Load fiber groups        
    ROR03 = dir(fullfile(ORdir, '*Ecc0to3*-Lh_NOT_MD4.pdb'));
    LOR03= dir(fullfile(ORdir, '*Ecc0to3*-Rh_NOT_MD4.pdb'));
    
    ROR1530 = dir(fullfile(ORdir, '*15to30*-Lh_NOT_MD4.pdb'));
    LOR1530= dir(fullfile(ORdir, '*15to30*-Rh_NOT_MD4.pdb'));
    
    ROR3090 = dir(fullfile(ORdir, '*30to90*-Lh_NOT_MD4.pdb'));
    LOR3090= dir(fullfile(ORdir, '*30to90*-Rh_NOT_MD4.pdb'));
    
    else sprintf('- few or too much fiber groups, check OR directory \n \n- %s',ORdir)
    return
    end
     
    
    R_OR03 = fgRead(fullfile(ORdir,ROR03.name));
    L_OR03 = fgRead(fullfile(ORdir,LOR03.name));    
    
    R_OR1530 = fgRead(fullfile(ORdir,ROR1530.name));
    L_OR1530 = fgRead(fullfile(ORdir,LOR1530.name));
    
    R_OR3090 = fgRead(fullfile(ORdir,ROR3090.name));
    L_OR3090 = fgRead(fullfile(ORdir,LOR3090.name));
    
    % make fiber roi and unite coordinates
    R_OR03_roi = dtiCreateRoiFromFibers(R_OR03);
    R_OR03_roi.coords = unique(R_OR03_roi.coords,'rows');
    
    L_OR03_roi = dtiCreateRoiFromFibers(L_OR03);
    L_OR03_roi.coords = unique(L_OR03_roi.coords,'rows');
    
    R_OR1530_roi = dtiCreateRoiFromFibers(R_OR1530);
    R_OR1530_roi.coords = unique(R_OR1530_roi.coords,'rows');
    
    L_OR1530_roi = dtiCreateRoiFromFibers(L_OR1530);
    L_OR1530_roi.coords = unique(L_OR1530_roi.coords,'rows');
    
    R_OR3090_roi = dtiCreateRoiFromFibers(R_OR3090);
    R_OR3090_roi.coords = unique(R_OR3090_roi.coords,'rows');
    
    L_OR3090_roi = dtiCreateRoiFromFibers(L_OR3090);
    L_OR3090_roi.coords = unique(L_OR3090_roi.coords,'rows');
    
    
    % Make new ROI
    R_03_intersect =  dtiNewRoi('R_03_intersect',[], intersect(R_OR03_roi.coords,R_OR3090_roi.coords,'rows')) ;
    R_03_setdiff  = dtiNewRoi('R_03_setdiff',[], setdiff(R_OR03_roi.coords,R_OR3090_roi.coords,'rows')) ;    
    R_90_setdiff  = dtiNewRoi('R_03_setdiff',[], setdiff(R_OR3090_roi.coords,R_OR03_roi.coords,'rows')) ;

    L_03_intersect =  dtiNewRoi('L_03_intersect',[], intersect(L_OR03_roi.coords,L_OR3090_roi.coords,'rows')) ;
    L_03_setdiff  = dtiNewRoi('L_03_setdiff',[], setdiff(L_OR03_roi.coords,L_OR3090_roi.coords,'rows')) ;    
    L_90_setdiff  = dtiNewRoi('L_03_setdiff',[], setdiff(L_OR3090_roi.coords,L_OR03_roi.coords,'rows')) ;
    
    
    
    
    
    % Render a figure 
    if shofig == 1
%            C = lines(6)
           C = hot(6);
           figure; hold on;
           % right
           AFQ_RenderRoi(R_03_intersect,C(1,:))
           AFQ_RenderRoi(R_03_setdiff,C(2,:))
           AFQ_RenderRoi(R_90_setdiff,C(3,:))
           % left
           AFQ_RenderRoi(L_03_intersect,C(1,:))
           AFQ_RenderRoi(L_03_setdiff,C(2,:))
           AFQ_RenderRoi(L_90_setdiff,C(3,:))
           
           ni=niftiRead(dt6.files.t1);
           AFQ_AddImageTo3dPlot(ni,[0 ,0 ,-25])
           camlight left
           
           L1 = line([60,70],[-110,-110],[-25,-25]);
           set(L1,'Linewidth',2,'color',[1,1,1])
           
           L2 = line([65,65],[-105,-115],[-25,-25]);
           set(L2,'Linewidth',2,'color',[1,1,1])      
           
           title(sprintf('%s',subs{ii}(1:9)));
           axis off           
           hold off;
           
           saveas(gca,fullfile('/home/ganka/git/AMD/Figure_OR',[sprintf('%s',subs{ii}(1:9)),'_segmentedOR.eps']),'psc2');
    end
    
    %% save ROIs
    ROIdir = fullfile(SubDir,'dwi_1st/fgROIs');
    if ~exist(ROIdir,'dir');mkdir(ROIdir);end
    
    
    
    
end
return

AMD = struct;

    % calc properties
    [fa,md,ad,rd]  = dtiGetValFromTensors(dt6.dt6, R_03_intersect.coords, inv(dt6.xformToAcpc),'fa md ad rd');    

    AMD(ii,1).name = R_03_intersect.name;
    AMD(ii,1).fa   = mean(fa;
    AMD(ii,1).md   = md;
    AMD(ii,1).ad   = ad;
    AMD(ii,1).rd   = rd;
    
    [fa,md,ad,rd]  = dtiGetValFromTensors(dt6.dt6, R_03_setdiff.coords, inv(dt6.xformToAcpc),'fa md ad rd');
    
    [fa,md,ad,rd]  = dtiGetValFromTensors(dt6.dt6, R_90_setdiff.coords, inv(dt6.xformToAcpc),'fa md ad rd');
    
    [fa,md,ad,rd]  = dtiGetValFromTensors(dt6.dt6, L_03_intersect.coords, inv(dt6.xformToAcpc),'fa md ad rd');    
    
    [fa,md,ad,rd]  = dtiGetValFromTensors(dt6.dt6, L_03_setdiff.coords, inv(dt6.xformToAcpc),'fa md ad rd');
    
    [fa,md,ad,rd]  = dtiGetValFromTensors(dt6.dt6, L_90_setdiff.coords, inv(dt6.xformToAcpc),'fa md ad rd');

                                                 
     FA = mean(fa)
     MD = mean(md)
     AD = mean(ad)
     RD = mean(rd)
    
    
    
    
    
    
